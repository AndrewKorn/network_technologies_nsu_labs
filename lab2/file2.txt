package main

import (
	"fmt"
	"io"
	"net"
	"os"
	"strconv"
)

func main() {
	args := os.Args
	if len(args) != 4 {
		fmt.Println("Invalid number of arguments. Needs file path, server ip and server port")
		return
	}

	filePath := args[1]
	serverIp := args[2]
	serverPort := args[3]

	fileStat, err := os.Stat(filePath)
	if err != nil {
		fmt.Println(err)
		return
	}

	var fileSize = int(fileStat.Size())
	fileName := fileStat.Name()
	fmt.Printf("File Path: %s\nServer: %s:%s\nFile: %s %d kb\n", filePath, serverIp, serverPort, fileName, fileSize)

	connection, err := net.Dial("tcp", serverIp+":"+serverPort)
	if err != nil {
		fmt.Println(err)
		return
	}

	fmt.Fprint(connection, fileName+"\n")
	fmt.Fprint(connection, strconv.Itoa(fileSize)+"\n")

	file, _ := os.Open(filePath)

	sendBuf := make([]byte, fileSize)
	for {
		_, err := file.Read(sendBuf)
		if err == io.EOF {
			break
		}
		fmt.Fprint(connection, string(sendBuf))
	}

}

